<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HabitFlow - Build & Break Habits</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Home Screen -->
        <div id="home-screen" class="screen active">
            <header class="header">
                <div class="header-content">
                    <h1 class="app-title">HabitFlow</h1>
                    <div class="greeting" id="greeting">Welcome back, User!</div>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-number" id="days-logged">0</span>
                            <span class="stat-label">Days Logged</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="active-habits">0</span>
                            <span class="stat-label">Active Habits</span>
                        </div>
                    </div>
                    <button id="profile-btn" class="profile-btn">Profile</button>
                </div>
            </header>
            
            <div class="home-content">
                <div class="habit-flow-card build-card" onclick="navigateTo('build-habits')">
                    <div class="card-background">
                        <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop&crop=center" alt="Build Habits" class="card-image">
                    </div>
                    <div class="card-content">
                        <h3>Build a Habit</h3>
                        <p>Start forming positive habits with proven methods</p>
                    </div>
                </div>
                
                <div class="habit-flow-card break-card" onclick="navigateTo('break-habits')">
                    <div class="card-background">
                        <img src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=400&h=300&fit=crop&crop=center" alt="Break Habits" class="card-image">
                    </div>
                    <div class="card-content">
                        <h3>Break a Habit</h3>
                        <p>Overcome unwanted behaviors with targeted strategies</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Build Habits Screen -->
        <div id="build-habits-screen" class="screen">
            <header class="header">
                <div class="header-content">
                    <button class="back-btn" onclick="navigateTo('home')">← Back</button>
                    <h2>Build a Habit</h2>
                </div>
            </header>
            
            <div class="search-container">
                <input type="text" id="build-search" placeholder="Search habits..." class="search-input" oninput="searchHabits('build')">
            </div>
            
            <div class="habits-list" id="build-habits-list">
                <div class="habit-card" data-habit="drink-water" onclick="selectHabit('drink-water', 'build')">
                    <img src="https://images.unsplash.com/photo-1548839140-29a749e1cf4d?w=80&h=80&fit=crop&crop=center" alt="Water" class="habit-image">
                    <div class="habit-info">
                        <h4>Drink More Water</h4>
                        <p>Stay hydrated and boost your energy</p>
                    </div>
                </div>
                
                <div class="habit-card" data-habit="wake-early" onclick="selectHabit('wake-early', 'build')">
                    <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=80&h=80&fit=crop&crop=center" alt="Sunrise" class="habit-image">
                    <div class="habit-info">
                        <h4>Wake Up Early</h4>
                        <p>Start your day with intention and productivity</p>
                    </div>
                </div>
                
                <div class="habit-card" data-habit="meditation" onclick="selectHabit('meditation', 'build')">
                    <img src="https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=80&h=80&fit=crop&crop=center" alt="Meditation" class="habit-image">
                    <div class="habit-info">
                        <h4>Practice Meditation</h4>
                        <p>Reduce stress and improve mental clarity</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Break Habits Screen -->
        <div id="break-habits-screen" class="screen">
            <header class="header">
                <div class="header-content">
                    <button class="back-btn" onclick="navigateTo('home')">← Back</button>
                    <h2>Break a Habit</h2>
                </div>
            </header>
            
            <div class="search-container">
                <input type="text" id="break-search" placeholder="Search habits..." class="search-input" oninput="searchHabits('break')">
            </div>
            
            <div class="habits-list" id="break-habits-list">
                <div class="habit-card" data-habit="procrastination" onclick="selectHabit('procrastination', 'break')">
                    <img src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=80&h=80&fit=crop&crop=center" alt="Time Management" class="habit-image">
                    <div class="habit-info">
                        <h4>Stop Procrastinating</h4>
                        <p>Overcome delays and boost productivity</p>
                    </div>
                </div>
                
                <div class="habit-card" data-habit="phone-use" onclick="selectHabit('phone-use', 'break')">
                    <img src="https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=80&h=80&fit=crop&crop=center" alt="Phone" class="habit-image">
                    <div class="habit-info">
                        <h4>Quit Excessive Phone Use</h4>
                        <p>Reduce screen time and improve focus</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Screen -->
        <div id="strategy-screen" class="screen">
            <header class="header">
                <div class="header-content">
                    <button class="back-btn" onclick="goBack()">← Back</button>
                    <h2 id="strategy-title">Habit Strategy</h2>
                </div>
            </header>
            
            <div class="strategy-content">
                <div class="habit-description" id="habit-description"></div>
                
                <div class="methods-section">
                    <h3>Recommended Methods</h3>
                    <div id="methods-list"></div>
                </div>
                
                <div class="quote-section" id="quote-section" style="display: none;">
                    <h3>Motivation</h3>
                    <blockquote id="motivational-quote"></blockquote>
                </div>
                
                <button class="start-btn" id="start-habit-btn" onclick="startHabit()">Start Habit Plan</button>
            </div>
        </div>

        <!-- Habits Management Screen -->
        <div id="habits-screen" class="screen">
            <header class="header">
                <div class="header-content">
                    <h2>My Habits</h2>
                </div>
            </header>
            
            <div class="habits-content" id="habits-content">
                <div class="no-habits" id="no-habits-message">
                    <img src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=200&h=200&fit=crop&crop=center" alt="No habits" class="no-habits-image">
                    <h3>No Active Habits</h3>
                    <p>Start building or breaking habits from the home screen!</p>
                    <button onclick="navigateTo('home')" class="start-btn">Get Started</button>
                </div>
                
                <div class="active-habits" id="active-habits-list"></div>
            </div>
        </div>

        <!-- Progress Screen -->
        <div id="progress-screen" class="screen">
            <header class="header">
                <div class="header-content">
                    <h2>Progress Overview</h2>
                </div>
            </header>
            
            <div class="progress-content" id="progress-content">
                <div class="no-progress" id="no-progress-message">
                    <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=200&h=200&fit=crop&crop=center" alt="No progress" class="no-progress-image">
                    <h3>No Progress Data</h3>
                    <p>Start tracking habits to see your progress!</p>
                    <button onclick="navigateTo('home')" class="start-btn">Get Started</button>
                </div>
                
                <div class="progress-habits" id="progress-habits-list"></div>
            </div>
        </div>

        <!-- Hotline Screen -->
        <div id="hotline-screen" class="screen">
            <header class="header">
                <div class="header-content">
                    <h2>Support & Hotline</h2>
                </div>
            </header>
            
            <div class="hotline-content">
                <div class="support-intro">
                    <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=120&h=120&fit=crop&crop=center" alt="Support" class="support-image">
                    <h3>You're Not Alone</h3>
                    <p>Breaking habits can be challenging. If you're struggling, professional support is available.</p>
                </div>
                
                <div class="hotline-list">
                    <div class="hotline-card">
                        <h4>General Support</h4>
                        <p>24/7 Crisis and Support</p>
                        <div class="phone-number">1-800-EXAMPLE</div>
                    </div>
                    
                    <div class="hotline-card">
                        <h4>Addiction Support</h4>
                        <p>Substance Abuse Helpline</p>
                        <div class="phone-number">1-800-HELP-NOW</div>
                    </div>
                    
                    <div class="hotline-card">
                        <h4>Mental Health</h4>
                        <p>Mental Health Crisis Line</p>
                        <div class="phone-number">1-800-MENTAL</div>
                    </div>
                </div>
                
                <div class="emergency-note">
                    <p><strong>In case of emergency:</strong> Call 911 or go to your nearest emergency room.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-btn" onclick="navigateTo('home')" data-tab="home">
            <div class="nav-icon">
                <img src="https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=24&h=24&fit=crop&crop=center" alt="Home">
            </div>
            <span class="nav-label">Home</span>
        </button>
        <button class="nav-btn" onclick="navigateTo('habits')" data-tab="habits">
            <div class="nav-icon">
                <img src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=24&h=24&fit=crop&crop=center" alt="Habits">
            </div>
            <span class="nav-label">Habits</span>
        </button>
        <button class="nav-btn" onclick="navigateTo('progress')" data-tab="progress">
            <div class="nav-icon">
                <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=24&h=24&fit=crop&crop=center" alt="Progress">
            </div>
            <span class="nav-label">Progress</span>
        </button>
        <button class="nav-btn" onclick="navigateTo('hotline')" data-tab="hotline">
            <div class="nav-icon">
                <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=24&h=24&fit=crop&crop=center" alt="Support">
            </div>
            <span class="nav-label">Support</span>
        </button>
    </nav>

    <script src="script.js"></script>
    <script type="module">
        import { auth, db } from './src/firebase-config.js';
        import { onAuthStateChanged } from 'firebase/auth';
        import { doc, getDoc } from 'firebase/firestore';

        onAuthStateChanged(auth, async (user) => {
            if (user && user.emailVerified) {
                // User is authenticated and verified
                const greeting = document.getElementById("greeting");
                if (greeting) {
                    try {
                        const docRef = doc(db, "users", user.uid);
                        const docSnap = await getDoc(docRef);
                        const userData = docSnap.exists() ? docSnap.data() : null;
                        const displayName = userData?.name || user.displayName || user.email.split('@')[0];
                        greeting.textContent = `Welcome back, ${displayName}!`;
                    } catch (error) {
                        console.error('Error loading user data:', error);
                        greeting.textContent = `Welcome back, ${user.email.split('@')[0]}!`;
                    }
                }
                
                // Show profile button
                const profileBtn = document.getElementById('profile-btn');
                if (profileBtn) {
                    profileBtn.style.display = 'block';
                    profileBtn.addEventListener('click', () => {
                        window.location.href = 'profile.html';
                    });
                }
            } else {
                // User is not authenticated, redirect to login
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>